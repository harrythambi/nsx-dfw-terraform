# =============================================================================
# NSX-T Security Groups Configuration
# =============================================================================
# This file defines security groups using various criteria types.
# Order is preserved - groups are created in the order defined here.
# =============================================================================

security_groups:
  # -------------------------------------------------------------------------
  # Example: Tag-based group
  # -------------------------------------------------------------------------
  - name: web-servers
    display_name: "Web Servers"
    description: "All web server VMs"
    criteria:
      - conditions:
          - key: Tag
            member_type: VirtualMachine
            operator: EQUALS
            value: "web|tier"

  # -------------------------------------------------------------------------
  # Example: IP Address-based group
  # -------------------------------------------------------------------------
  - name: trusted-networks
    display_name: "Trusted Networks"
    description: "Trusted IP ranges"
    criteria:
      - ip_addresses:
          - "10.0.0.0/8"
          - "172.16.0.0/12"
          - "192.168.0.0/16"

  # -------------------------------------------------------------------------
  # Example: Segment-based group
  # -------------------------------------------------------------------------
  - name: prod-segment-vms
    display_name: "Production Segment VMs"
    description: "VMs on production segments"
    criteria:
      - conditions:
          - key: Tag
            member_type: Segment
            operator: EQUALS
            value: "production|environment"

  # -------------------------------------------------------------------------
  # Example: Multiple criteria with conjunction
  # -------------------------------------------------------------------------
  - name: db-servers
    display_name: "Database Servers"
    description: "Database servers in production"
    criteria:
      - conditions:
          - key: Tag
            member_type: VirtualMachine
            operator: EQUALS
            value: "database|tier"
      - conditions:
          - key: Tag
            member_type: VirtualMachine
            operator: EQUALS
            value: "production|environment"
    conjunction: "OR"

  # -------------------------------------------------------------------------
  # Example: Name-based group
  # -------------------------------------------------------------------------
  - name: app-servers
    display_name: "Application Servers"
    description: "VMs with app in the name"
    criteria:
      - conditions:
          - key: Name
            member_type: VirtualMachine
            operator: CONTAINS
            value: "app"

  # -------------------------------------------------------------------------
  # Example: Static Members - Virtual Machines (by display name)
  # Note: Commented out - requires VMs to exist in your NSX inventory
  # The module looks up VMs by display name automatically
  # -------------------------------------------------------------------------
  # - name: specific-vms
  #   display_name: "Specific Virtual Machines"
  #   description: "Manually selected VMs by display name"
  #   members:
  #     virtual_machines:
  #       - "web-server-01"      # VM display name (not path!)
  #       - "web-server-02"      # Module resolves to path automatically
  #       - "app-server-01"

  # -------------------------------------------------------------------------
  # Example: Static Members - NSX Segments (by display name)
  # Note: Commented out - requires segments to exist
  # -------------------------------------------------------------------------
  # - name: selected-segments
  #   display_name: "Selected Segments"
  #   description: "Manually selected network segments by display name"
  #   members:
  #     segments:
  #       - "Web-Segment"        # Segment display name
  #       - "App-Segment"        # Module resolves to path automatically

  # -------------------------------------------------------------------------
  # Example: Static Members - Nested Groups (by name)
  # -------------------------------------------------------------------------
  # - name: combined-group
  #   display_name: "Combined Group"
  #   description: "Group containing other groups by name"
  #   members:
  #     groups:
  #       - web-servers          # Reference group defined in this file
  #       - app-servers          # Reference group defined in this file
  #       - "Existing-Group"     # Or reference existing group by display name

  # -------------------------------------------------------------------------
  # Example: Static Members - Mixed Types (all by display name)
  # Note: Commented out - requires objects to exist in your environment
  # -------------------------------------------------------------------------
  # - name: mixed-members
  #   display_name: "Mixed Static Members"
  #   description: "Group with various static member types"
  #   members:
  #     virtual_machines:
  #       - "db-server-01"       # VM display name
  #       - "db-server-02"
  #     segments:
  #       - "Database-Segment"   # Segment display name
  #     groups:
  #       - web-servers          # Group name from this config
  #       - "External-Group"     # Existing group display name

  # -------------------------------------------------------------------------
  # Example: Combining Criteria and Static Members
  # -------------------------------------------------------------------------
  # - name: hybrid-group
  #   display_name: "Hybrid Group"
  #   description: "Combines dynamic criteria with static members"
  #   criteria:
  #     - conditions:
  #         - key: Tag
  #           value: "web|tier"
  #   members:
  #     virtual_machines:
  #       - "special-vm-01"      # Add specific VM by display name

  # -------------------------------------------------------------------------
  # Example: Group with tags
  # -------------------------------------------------------------------------
  - name: external-services
    display_name: "External Services"
    description: "External service endpoints"
    criteria:
      - ip_addresses:
          - "8.8.8.8"
          - "8.8.4.4"
    tags:
      - scope: "managed-by"
        tag: "terraform"
      - scope: "environment"
        tag: "production"
