# =============================================================================
# NSX-T Security Groups Configuration
# =============================================================================
# This file defines security groups using various criteria types.
# Order is preserved - groups are created in the order defined here.
# =============================================================================

security_groups:
  # -------------------------------------------------------------------------
  # Example: Tag-based group
  # -------------------------------------------------------------------------
  - name: web-servers
    display_name: "Web Servers"
    description: "All web server VMs"
    criteria:
      - conditions:
          - key: Tag
            member_type: VirtualMachine
            operator: EQUALS
            value: "web|tier"

  # -------------------------------------------------------------------------
  # Example: IP Address-based group
  # -------------------------------------------------------------------------
  - name: trusted-networks
    display_name: "Trusted Networks"
    description: "Trusted IP ranges"
    criteria:
      - ip_addresses:
          - "10.0.0.0/8"
          - "172.16.0.0/12"
          - "192.168.0.0/16"

  # -------------------------------------------------------------------------
  # Example: Segment-based group
  # -------------------------------------------------------------------------
  - name: prod-segment-vms
    display_name: "Production Segment VMs"
    description: "VMs on production segments"
    criteria:
      - conditions:
          - key: Tag
            member_type: Segment
            operator: EQUALS
            value: "production|environment"

  # -------------------------------------------------------------------------
  # Example: Multiple criteria with conjunction
  # -------------------------------------------------------------------------
  - name: db-servers
    display_name: "Database Servers"
    description: "Database servers in production"
    criteria:
      - conditions:
          - key: Tag
            member_type: VirtualMachine
            operator: EQUALS
            value: "database|tier"
      - conditions:
          - key: Tag
            member_type: VirtualMachine
            operator: EQUALS
            value: "production|environment"
    conjunction: "OR"

  # -------------------------------------------------------------------------
  # Example: Name-based group
  # -------------------------------------------------------------------------
  - name: app-servers
    display_name: "Application Servers"
    description: "VMs with app in the name"
    criteria:
      - conditions:
          - key: Name
            member_type: VirtualMachine
            operator: CONTAINS
            value: "app"

  # -------------------------------------------------------------------------
  # Example: Static Members - Virtual Machines
  # Note: Commented out - requires actual VM paths from your environment
  # Get VM paths from: NSX Manager > Inventory > Virtual Machines
  # -------------------------------------------------------------------------
  # - name: specific-vms
  #   display_name: "Specific Virtual Machines"
  #   description: "Manually selected VMs"
  #   members:
  #     virtual_machines:
  #       - "/infra/realized-state/enforcement-points/default/virtual-machines/vm-123"
  #       - "/infra/realized-state/enforcement-points/default/virtual-machines/vm-456"

  # -------------------------------------------------------------------------
  # Example: Static Members - NSX Segments
  # Note: Commented out - requires actual segment paths from your environment
  # -------------------------------------------------------------------------
  # - name: selected-segments
  #   display_name: "Selected Segments"
  #   description: "Manually selected network segments"
  #   members:
  #     segments:
  #       - "/infra/segments/web-segment"
  #       - "/infra/segments/app-segment"

  # -------------------------------------------------------------------------
  # Example: Static Members - Nested Groups
  # Note: Commented out - requires existing groups
  # -------------------------------------------------------------------------
  # - name: combined-group
  #   display_name: "Combined Group"
  #   description: "Group containing other groups"
  #   members:
  #     groups:
  #       - web-servers           # Reference by name (defined above)
  #       - app-servers           # Reference by name (defined above)
  #       - "/infra/domains/default/groups/existing-group"  # Or by path

  # -------------------------------------------------------------------------
  # Example: Static Members - Mixed Types
  # Note: Commented out - requires actual paths from your environment
  # -------------------------------------------------------------------------
  # - name: mixed-members
  #   display_name: "Mixed Static Members"
  #   description: "Group with various static member types"
  #   members:
  #     virtual_machines:
  #       - "/infra/realized-state/enforcement-points/default/virtual-machines/vm-789"
  #     segments:
  #       - "/infra/segments/db-segment"
  #     segment_ports:
  #       - "/infra/segments/web-segment/ports/port-001"
  #     groups:
  #       - web-servers
  #     # Also supported:
  #     # vifs: []
  #     # physical_servers: []
  #     # distributed_port_groups: []
  #     # distributed_ports: []

  # -------------------------------------------------------------------------
  # Example: Combining Criteria and Static Members
  # Note: Commented out - requires actual paths
  # -------------------------------------------------------------------------
  # - name: hybrid-group
  #   display_name: "Hybrid Group"
  #   description: "Combines dynamic criteria with static members"
  #   criteria:
  #     - conditions:
  #         - key: Tag
  #           value: "web|tier"
  #   members:
  #     virtual_machines:
  #       - "/infra/realized-state/enforcement-points/default/virtual-machines/special-vm"

  # -------------------------------------------------------------------------
  # Example: Group with tags
  # -------------------------------------------------------------------------
  - name: external-services
    display_name: "External Services"
    description: "External service endpoints"
    criteria:
      - ip_addresses:
          - "8.8.8.8"
          - "8.8.4.4"
    tags:
      - scope: "managed-by"
        tag: "terraform"
      - scope: "environment"
        tag: "production"
