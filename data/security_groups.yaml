# =============================================================================
# NSX-T Security Groups Configuration
# =============================================================================
# Defines WHO is included in firewall rules (sources and destinations).
#
# MEMBERSHIP TYPES:
#   members:   Static membership - list objects by display name
#     virtual_machines: [vm1, vm2]
#     segments: [seg1, seg2]
#     groups: [group1, group2]    (nested groups)
#
#   criteria:  Dynamic membership - match by tags, IPs, conditions
#     conditions: [{value: "scope|tag", member_type: VirtualMachine}]
#     ip_addresses: [10.0.0.0/8, 192.168.0.0/16]
#
#   tags:      Resource tags ON the group itself (for organization)
#
# MEMBER TYPES FOR CONDITIONS:
#   VirtualMachine (default), Segment, SegmentPort, IPSet, Group
# =============================================================================

security_groups:
  # ---------------------------------------------------------------------------
  # Static Membership - VMs by display name
  # ---------------------------------------------------------------------------

  - name: vm-group-nas
    display_name: "NAS Servers"
    description: "NAS servers"
    members:
      virtual_machines:
        - rod11-nas01
        - rod11-nas02
    tags:
      - scope: managed-by
        tag: terraform

  - name: vm-group-vcenter
    display_name: "vCenter Servers"
    description: "vCenter and VCD servers"
    members:
      virtual_machines:
        - rod11-vc01
        - rod11-vcd01

  - name: vm-group-management
    display_name: "Management VMs"
    description: "All management VMs"
    members:
      virtual_machines:
        - rod11-linmgmt01
        - rod11-winmgmt01
        - rod11-vc01
        - rod11-vcd01

  - name: vm-group-nsx
    display_name: "NSX Infrastructure"
    description: "NSX manager and edge VMs"
    members:
      virtual_machines:
        - rod11-nsx01
        - rod11-nsx-en02

  # ---------------------------------------------------------------------------
  # Static Membership - Segments by display name
  # ---------------------------------------------------------------------------

  - name: segment-group-tenant01
    display_name: "Tenant01 Segments"
    description: "All tenant01 segments"
    members:
      segments:
        - automation-tenant01-backend
        - automation-tenant01-frontend
        - automation-tenant01-mgmt

  - name: segment-group-tenant02
    display_name: "Tenant02 Segments"
    description: "All tenant02 segments"
    members:
      segments:
        - automation-tenant02-backend
        - automation-tenant02-frontend
        - automation-tenant02-mgmt

  - name: segment-group-holodeck
    display_name: "Holodeck Segments"
    description: "Holodeck lab segments"
    members:
      segments:
        - holodeck-lab1-site-a-trunk
        - holodeck-lab1-site-b-trunk
        - holodeck-mgmt

  - name: segment-group-infra
    display_name: "Infrastructure Segments"
    description: "Infrastructure network segments"
    members:
      segments:
        - rod11-avi-mgmt
        - rod11-avi-se-data
        - rod11-avn

  # ---------------------------------------------------------------------------
  # Nested Groups - Reference other groups by name
  # ---------------------------------------------------------------------------

  - name: nested-group-all-vms
    display_name: "All VM Groups Combined"
    description: "Nested group containing other VM groups"
    members:
      groups:
        - vm-group-nas
        - vm-group-management
        - vm-group-nsx

  - name: nested-group-all-segments
    display_name: "All Segment Groups Combined"
    description: "Nested group containing other segment groups"
    members:
      groups:
        - segment-group-tenant01
        - segment-group-tenant02
        - segment-group-holodeck
        - segment-group-infra

  # ---------------------------------------------------------------------------
  # Mixed Static Members
  # ---------------------------------------------------------------------------

  - name: mixed-group-avi
    display_name: "AVI Infrastructure"
    description: "AVI-related segments"
    members:
      segments:
        - rod11-avi-mgmt
        - rod11-avi-se-data

  - name: mixed-group-complete
    display_name: "Complete Mixed Group"
    description: "VMs, segments, and nested groups combined"
    members:
      virtual_machines:
        - rod11-linmgmt01
      segments:
        - rod11-avn
      groups:
        - vm-group-nas

  # ---------------------------------------------------------------------------
  # Dynamic Membership - Criteria block
  # ---------------------------------------------------------------------------

  # Tag-based VM group (member_type defaults to VirtualMachine)
  - name: hybrid-group-tagged-plus-static
    display_name: "Hybrid Tagged and Static"
    description: "Combines tag criteria with static VM members"
    criteria:
      - conditions:
          - value: production|environment
    members:
      virtual_machines:
        - rod11-vc01
        - rod11-vcd01

  # IP address group
  - name: ip-group-management
    display_name: "Management Networks"
    description: "IP-based management networks"
    criteria:
      - ip_addresses:
          - 10.0.0.0/8
          - 192.168.0.0/16

  # ---------------------------------------------------------------------------
  # All Lab VMs
  # ---------------------------------------------------------------------------

  - name: all-lab-vms
    display_name: "All Lab VMs"
    description: "Every VM in the lab environment"
    members:
      virtual_machines:
        - rod11-linmgmt01
        - rod11-nas01
        - rod11-nas02
        - rod11-nsx-en02
        - rod11-nsx01
        - rod11-vc01
        - rod11-vcd01
        - rod11-winmgmt01
