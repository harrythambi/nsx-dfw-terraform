# =============================================================================
# NSX-T Services Configuration
# =============================================================================
# Defines WHAT traffic (ports/protocols) is allowed in firewall rules.
#
# FORMATS:
#   ports:           Simple "port/protocol" format (e.g., "80/tcp", "53/udp")
#   l4_port_set_entries: Verbose format for complex cases
#   icmp_entries:    ICMP type/code definitions
#   ip_protocol_entries: Raw IP protocol numbers
#   algorithm_entries:   ALG services (FTP, TFTP, etc.)
#   members.services:    Nested service groups (reference other services)
#
# PREDEFINED SERVICES:
#   Reference built-in NSX services by name: DNS, NTP, HTTP, HTTPS, SSH, etc.
# =============================================================================

services:
  # ---------------------------------------------------------------------------
  # TCP/UDP Services - Simple 'ports' format
  # ---------------------------------------------------------------------------

  - name: web-services
    display_name: "Web Services"
    description: "HTTP and HTTPS"
    ports:
      - 80/tcp
      - 443/tcp
    tags:
      - scope: managed-by
        tag: terraform

  - name: database-services
    display_name: "Database Services"
    description: "Common database ports"
    ports:
      - 3306/tcp      # MySQL
      - 5432/tcp      # PostgreSQL
      - 27017/tcp     # MongoDB
      - 6379/tcp      # Redis

  - name: custom-app
    display_name: "Custom Application"
    description: "Custom application ports"
    ports:
      - 8080/tcp
      - 8443/tcp
      - 9090/tcp

  - name: ephemeral-ports
    display_name: "Ephemeral Ports"
    description: "High port ranges"
    ports:
      - 49152-65535/tcp
      - 49152-65535/udp

  # ---------------------------------------------------------------------------
  # ICMP Services
  # ---------------------------------------------------------------------------

  - name: icmp-all
    display_name: "ICMP All"
    description: "All ICMP traffic"
    icmp_entries:
      - display_name: "ICMPv4 All"
        protocol: ICMPv4
      - display_name: "ICMPv6 All"
        protocol: ICMPv6

  - name: icmp-ping
    display_name: "ICMP Ping"
    description: "ICMP echo request/reply only"
    icmp_entries:
      - display_name: "Echo Request"
        protocol: ICMPv4
        icmp_type: 8
      - display_name: "Echo Reply"
        protocol: ICMPv4
        icmp_type: 0

  # ---------------------------------------------------------------------------
  # Other Protocol Types
  # ---------------------------------------------------------------------------

  - name: gre-protocol
    display_name: "GRE Protocol"
    description: "GRE tunnel protocol"
    ip_protocol_entries:
      - display_name: "GRE"
        protocol: 47

  - name: ftp-service
    display_name: "FTP Service"
    description: "FTP with ALG support"
    algorithm_entries:
      - display_name: "FTP"
        algorithm: FTP
        destination_port: "21"

  - name: arp-service
    display_name: "ARP Service"
    description: "ARP protocol"
    ether_type_entries:
      - display_name: "ARP"
        ether_type: 2054

  # ---------------------------------------------------------------------------
  # Nested Service Groups - Reference other services
  # ---------------------------------------------------------------------------

  - name: all-web-services
    display_name: "All Web Services"
    description: "Combined web and custom app services"
    members:
      services:
        - web-services
        - custom-app

  - name: standard-services
    display_name: "Standard Network Services"
    description: "Common network services bundle"
    members:
      services:
        - DNS           # predefined NSX service
        - NTP           # predefined NSX service
        - icmp-all      # custom service defined above
